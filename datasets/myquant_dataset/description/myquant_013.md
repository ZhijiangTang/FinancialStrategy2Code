# 日内回转交易(股票)

分享

阅读 89072
 更新 2022-05-09 16:56:48

* [日内回转策略(股票)](#b47cfad4c6c99652)
  + [1. 原理](#4d68e06c45acd2a2)
    - [1.1 日内回转交易](#06f595f138bb40a0)
    - [1.2 股票的日内回转交易](#392304c3971efd73)
    - [1.3 MACD指标简介](#509702eac2040b89)
  + [2. 策略思路](#cf0127fe1bcb3311)
  + [3. 策略代码](#69a3fc437f0227e3)
  + [4. 回测结果与稳健性分析](#3e2df45effccee1c)

# 日内回转策略(股票)

## 1. 原理

### 1.1 日内回转交易

日内回转交易，顾名思义就是在一天内完成“买”和“卖”两个相反方向的操作（可一次也可多次），也就是“T+0”交易。

日内回转可用于股票和期货。其中期货采用“T+0”交易制度，可以直接进行日内回转交易。由于A股采用的是“T+1”交易制度，无法直接进行日内回转交易，需要先配置一定的底仓再进行回转交易。

### 1.2 股票的日内回转交易

**怎样对股票进行日内回转交易？**

首先，在正式交易的前一个交易日配置一定的底仓。以500股为例，记做total = 500。

然后开始正式的日内回转交易。

配置底仓的作用是利用替代法实现“T+0”。由于当天买入的股票当天不能卖出，但底仓是可以卖出的，用底仓替代新买入的股票进行卖出操作。假设在第二个交易日发生了1次买入，5次卖出交易，每次交易买卖数量为100股。利用turnaround = [0,0]变量记录每次交易的数量，也是当天收盘时需要回转的记录。其中第一个数据表示当日买入数量，第二个数据表示当日卖出数量。下表为单个交易日的买卖信号。

| 信号方向 | 数量 | 交易记录 | 剩余可回转的数量 | 总仓位 |
| --- | --- | --- | --- | --- |
| 买 | 100 | [100,0] | 500 | 600 |
| 卖 | 100 | [100,100] | 400 | 500 |
| 卖 | 100 | [100,200] | 300 | 400 |
| 卖 | 100 | [100,300] | 200 | 300 |
| 卖 | 100 | [100,400] | 100 | 200 |

**假设在表的最后再加一个卖出信号是否可行？**

答案是**不可行**。

因为如果再加一个卖出信号，需要回转的股票数量变为[100,500]，即开多100股，开空500股。这就意味着在当天收盘之前，需要卖出100股，再买入500股进行回转。这个交易日内已经出现5次卖出信号，底仓的500股已经全部卖出，仅有100股今日买入的仓位，这部分股票是不能当日卖出的。所以，不能再添加卖出信号。

因此，在判断买入或卖出信号是否能执行时，隐含一个判断条件。即：

**每次交易的数量 + 当日买入的数量（turnaround的第一位）< 底仓数量（以卖出信号为例）**。

### 1.3 MACD指标简介

MACD又称“异移动平均线”，是根据双指数移动平均线发展而来。由快的指数（常12）减去慢的指数（常26）得到DIF，再用2×（快线DIF-DIF的9日加权移动均线DEA）得到MACD柱。

DIF的计算方法为： DIF = 当天的12日指数移动平均值 - 当天的26日指数应对平均值。  
***注：上市首日的EMA12和EMA26利用当天的收盘价替代。***

## 2. 策略思路

第一步：设置变量  
**context.first:底仓配置信号，0表示未配置底仓；1表示配置底仓。  
context.trade\_n:每次交易数量。  
context.day:用来获取前一交易日的时间和最新交易日的时间，第一位是最新交易日，第二位是前一交易日。当二者不同时，意味着新的一天，需要初始化其他变量。  
context.ending：开始回转信号，0表示未触发；1表示已触发。  
context.turnaround：当日买卖股票操作记录，也是回转记录。第一位代表买入股数，第二位代表卖出股数。**

第二步：计算MACD指标，设计交易信号  
当 MACD 小于 0 时，买入对应股票100手；  
当 MACD 大于 0 时，卖出对应股票100手;

第三步：接近收盘时，全部回转

回测标的：SHSE.600000  
回测期：2017-09-01 8:00:00 到2017-10-01 16:00:00  
回测初始资金：200万

## 3. 策略代码

```