# Financial Strategy Paper-to-Code System

## 项目概述
本系统专注于将金融策略论文内容精准转化为可执行的算法代码，通过强化学习技术确保生成代码与论文描述高度一致。

## 核心功能
- **论文一致性评分**：基于术语匹配度、公式实现和结构匹配进行奖励计算
- **金融策略要素提取**：自动识别信号生成、风险控制等核心要素
- **强化学习代码生成**：支持自动补全缺失术语和优化代码结构

## 目录结构
```
├── analyzer.py                # 论文要素提取器
├── rl/
│   ├── trainer.py             # 强化学习训练器
│   └── __init__.py
├── __init__.py
└── README.md
```

## 数据集
- `datasets/merged_strategy_dataset.json`：包含策略描述→代码映射的金融领域专用数据集
- 支持术语提取、公式匹配、结构对比等核心功能验证

## 系统架构全景图
```
+----------------------+     +----------------------+     +----------------------+
|  论文解析模块        |     |  强化学习引擎        |     |  代码生成模块        |
|  - 提取公式          |<--->|  - 状态空间建模      |<--->|  - 模块生成          |
|  - 识别术语          |     |  - 动作空间决策      |     |  - 函数实现          |
+----------+-----------+     +----------+-----------+     +----------+-----------+
           |                            |                            |
           v                            v                            v
+----------+-----------+     +----------+-----------+     +----------+-----------+
| 评分适配器模块       |     |  训练流程控制        |     | 代码优化建议模块     |
| - 公式匹配评分       |     | - 多轮迭代训练       |     | - 缺失术语补全       |
+----------------------+     +----------------------+     +----------------------+
```

## 技术创新点详述
### 1. 强化学习目标重构
- **传统目标**：最大化回测夏普比率
- **新目标**：最大化代码与论文的匹配度（0-100分）
- **奖励函数设计**：
```python
reward = 公式匹配奖励(40%) + 术语一致性奖励(20%) + 结构匹配奖励(10%) - 缺失项惩罚
```

### 2. 状态空间建模
```python
def extract_paper_elements(paper_text):
    return {
        "signal_generation": extract_keyphrase(paper_text, "信号生成"),
        "core_formulas": extract_math_formulas(paper_text),  # 提取论文公式
        "risk_control": extract_keyphrase(paper_text, "风险控制")
    }
```

### 3. 动作空间定义
| 动作类型       | 示例动作                          | 对应论文要素匹配          |
|----------------|-----------------------------------|---------------------------|
| 模块生成       | 生成signal_generation.py文件      | 信号生成部分              |
| 函数实现       | 实现calculate_macd()函数          | 公式(3)                  |
| 注释添加       | 添加# 实现论文图2的交易逻辑注释   | 图表对应关系              |

### 4. 训练流程优化
```python
def train_step(self, generated_code):
    reward = self.reward_calculator.calculate_reward(paper_json, generated_code)
    if reward < 90 and self.reward_calculator.has_missing_terms():
        improved_code = self._suggest_improvements(generated_code)
        reward = self.reward_calculator.calculate_reward(paper_json, improved_code)
    return reward
```

### 5. 系统健壮性保障
- **模块导入优化**：动态路径规范化处理，解决`ModuleNotFoundError`
- **异常处理机制**：在ScoreAdapter和RLTrainer中添加详细日志和错误捕获
- **测试覆盖率**：集成测试覆盖术语检测、奖励计算、代码改进建议等全流程

## 特别声明：关于回测的学术立场

### 学术研究的聚焦点
本项目严格聚焦于验证论文策略的**理论可行性**，通过代码实现将抽象描述转化为可验证的逻辑实体。这种转化本身具有重要学术价值：
- 验证论文描述的自洽性（是否存在逻辑漏洞）
- 量化策略要素的可实现性（公式/术语能否转化为代码）
- 建立论文→代码的标准映射范式

### 回测的局限性认知
我们明确反对以下行业惯性思维：
| 传统认知 | 我们的观点 |
|---------|----------|
| 回测收益曲线决定策略优劣 | 历史数据无法预测未来市场行为 |
| 最大回撤代表风险水平 | 突发黑天鹅事件影响无法量化 |
| 参数优化提升策略表现 | 可能导致过度拟合历史数据 |

### 实用价值定位
我们的系统为交易员和金融决策者提供**可信赖的研究工具**：
1. **理论验证平台**：快速检验策略逻辑的完整性
2. **要素分析基础**：支持对关键参数的敏感性分析
3. **改进研究起点**：提供标准化代码框架供后续优化
4. **教学演示工具**：直观展示论文策略的实现过程

这种基于代码忠实度的研究，比单纯依赖历史回测更有助于发现策略的潜在缺陷，也为从业者提供了更可靠的理论分析基础。